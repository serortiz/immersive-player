node("builder") {
    properties([pipelineTriggers([
        [$class: 'GenericTrigger',
            genericVariables: [ [key: 'ref', value: '$.ref'], [key: 'username', value: '$.pusher.name'] ],
            causeString: 'Triggered on $ref',

            token: '5a20b1867bb011eda1eb0242ac120002',
            tokenCredentialId: '',

            printContributedVariables: true,
            printPostContent: true,

            silentResponse: false,

            regexpFilterText: '$ref',
            regexpFilterExpression: 'refs/heads/master' ]
    ])])

    stage ('Build hs-sdk') {
        res = build job: 'hs-sdk.build', parameters: [string(name: 'branch', value: 'master')]
        SDK_VERSION = res.getDescription()
    }

    stage('Trigger Pipeline Request Job') {
        build job: 'pipeline/pipeline-request-trigger', parameters: [
            [$class: 'StringParameterValue', name: 'deploy_jobname', value: 'hs-sdk/hs-sdk.deploy'],
            [$class: 'StringParameterValue', name: 'cleanup_jobname', value: 'hs-sdk/hs-sdk.cleanup'],
            [$class: 'StringParameterValue', name: 'upgrade_jobname', value: 'hs-sdk/hs-sdk.upgrade'],
            [$class: 'StringParameterValue', name: 'version', value: "${SDK_VERSION}"],
            [$class: 'StringParameterValue', name: 'component', value: 'hs-sdk'],
            [$class: 'StringParameterValue', name: 'username', value: "${username}"]
        ]
    }

}
